composer create-project symfony/skeleton task-api
cd task-api

composer require symfony/twig-bundle    ( Rendu HTML cÃ´tÃ© Symfony )
composer require symfony/serializer-pack  ( Transformer objets â†” JSON )
composer require symfony/validator ( Valider les donnÃ©es )
composer require symfony/orm-pack
composer require doctrine/annotations
composer require nelmio/cors-bundle










import { useCallback, useEffect, useMemo, useState, useRef } from 'react';
import { useNavigate } from 'react-router-dom';
import './vente.css';

function Vente() {
  console.log("ğŸ”„ COMPOSANT VENTE RE-RENDER");

  const [ventes, setVentes] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const navigate = useNavigate();

  // Utilisation de useRef pour les donnÃ©es qui ne nÃ©cessitent pas de re-render
  const selectedRowsRef = useRef(new Set());
  const checkboxRefs = useRef({});
  const totalRef = useRef(null);

  const formatDate = (dateString) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('fr-FR', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit'
    });
  };

  const fetchVentes = useCallback(() => {
    console.log("ğŸ“¥ FETCH VENTES - Chargement des donnÃ©es");
    setLoading(true);
    fetch('/ventes.json')
      .then((res) => {
        if (!res.ok) throw new Error("Erreur rÃ©seau");
        return res.json();
      })
      .then((data) => {
        console.log("âœ… DONNÃ‰ES CHARGÃ‰ES:", data.length, "ventes");
        setVentes(data);
      })
      .catch((err) => {
        console.error("âŒ ERREUR FETCH:", err);
        setError("Impossible de charger les ventes.");
      })
      .finally(() => {
        console.log("ğŸ FETCH TERMINÃ‰");
        setLoading(false);
      });
  }, []);

  useEffect(() => {
    fetchVentes();
  }, [fetchVentes]);

  // Fonction pour calculer le total
  const calculateTotal = useCallback(() => {
    console.log("ğŸ’° CALCUL TOTAL - Nombre d'Ã©lÃ©ments sÃ©lectionnÃ©s:", selectedRowsRef.current.size);
    const total = ventes
      .filter((v) => selectedRowsRef.current.has(v.id_vente))
      .reduce((total, v) => total + parseFloat(v.prix_vente), 0);
    console.log("ğŸ’° TOTAL CALCULÃ‰:", total);
    return total;
  }, [ventes]);

  // Fonction pour mettre Ã  jour le total dans le DOM
  const updateTotal = useCallback(() => {
    console.log("ğŸ“Š MISE Ã€ JOUR TOTAL DOM");
    if (totalRef.current) {
      const total = calculateTotal();
      totalRef.current.textContent = `Total des ventes sÃ©lectionnÃ©es : ${total.toLocaleString()} Ar`;
      console.log("ğŸ“Š TOTAL AFFICHÃ‰:", total.toLocaleString(), "Ar");
    }
  }, [calculateTotal]);

  // Fonction optimisÃ©e pour gÃ©rer la sÃ©lection sans re-render complet
  const toggleRowSelection = useCallback((id) => {
    console.log("ğŸ”„ TOGGLE ROW SELECTION - ID:", id);
    const selectedRows = selectedRowsRef.current;
    const checkbox = checkboxRefs.current[id];
    const row = checkbox?.closest('tr');

    if (selectedRows.has(id)) {
      console.log("âŒ DÃ‰SELECTION - ID:", id);
      selectedRows.delete(id);
      if (checkbox) {
        checkbox.checked = false;
        console.log("â˜‘ï¸ CHECKBOX DÃ‰COCHÃ‰E");
      }
      if (row) {
        row.classList.remove('selected');
        console.log("ğŸ¨ CLASSE 'selected' SUPPRIMÃ‰E");
      }
    } else {
      console.log("âœ… SÃ‰LECTION - ID:", id);
      selectedRows.add(id);
      if (checkbox) {
        checkbox.checked = true;
        console.log("â˜‘ï¸ CHECKBOX COCHÃ‰E");
      }
      if (row) {
        row.classList.add('selected');
        console.log("ğŸ¨ CLASSE 'selected' AJOUTÃ‰E");
      }
    }

    // Mise Ã  jour du total sans re-render
    updateTotal();
  }, [updateTotal]);

  // Fonction pour crÃ©er les lignes sans useMemo
  const createVentesRows = () => {
    console.log("ğŸ—ï¸ CRÃ‰ATION DES LIGNES - Nombre de ventes:", ventes.length);
    return ventes.map((vente) => {
      const isSelected = selectedRowsRef.current.has(vente.id_vente);
      console.log("ğŸ”¨ CRÃ‰ATION LIGNE - ID:", vente.id_vente, "- SÃ©lectionnÃ©e:", isSelected);

      return (
        <tr
          key={vente.id_vente}
          className={isSelected ? 'selected' : ''}
        >
          <td>
            <input
              type="checkbox"
              ref={(el) => {
                if (el) {
                  checkboxRefs.current[vente.id_vente] = el;
                  console.log("ğŸ“ REF CHECKBOX CRÃ‰Ã‰E - ID:", vente.id_vente);
                }
              }}
              defaultChecked={isSelected}
              onChange={() => toggleRowSelection(vente.id_vente)}
            />
          </td>
          <td>{vente.nom_produit}</td>
          <td>{vente.nom_client}</td>
          <td>{vente.nom_vendeur}</td>
          <td>{vente.quantite}</td>
          <td>{vente.prix_vente}</td>
          <td>{formatDate(vente.date_vente)}</td>
        </tr>
      );
    });
  };

  // Mise Ã  jour du total initial
  useEffect(() => {
    console.log("ğŸš€ EFFET - Mise Ã  jour du total initial");
    updateTotal();
  }, [updateTotal]);

  if (loading) {
    console.log("â³ Ã‰TAT LOADING");
    return <p>Chargement des ventes...</p>;
  }
  if (error) {
    console.log("âŒ Ã‰TAT ERROR:", error);
    return <p style={{ color: 'red' }}>{error}</p>;
  }

  console.log("ğŸ¨ RENDU PRINCIPAL DU COMPOSANT");
  return (
    <div className="App-vente">
      <div className="vente-container">
        <button className="back-button" onClick={() => navigate(-1)}>
          â¬… Retour
        </button>
        <h2>Liste des Ventes</h2>
        <table className="styled-table" border="1">
          <thead>
            <tr>
              <th>âœ”</th>
              <th>Produit</th>
              <th>Client</th>
              <th>Vendeur</th>
              <th>QuantitÃ©</th>
              <th>Prix</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            {createVentesRows()}
          </tbody>
        </table>
        <h3 ref={totalRef}>Total des ventes sÃ©lectionnÃ©es : 0 Ar</h3>
      </div>

      <div className="section-image-vente"> </div>
    </div>
  );
}

export default Vente;
