composer create-project symfony/skeleton task-api
cd task-api

composer require symfony/twig-bundle    ( Rendu HTML côté Symfony )
composer require symfony/serializer-pack  ( Transformer objets ↔ JSON )
composer require symfony/validator ( Valider les données )
composer require symfony/orm-pack
composer require doctrine/annotations
composer require nelmio/cors-bundle










import { useCallback, useEffect, useMemo, useState, useRef } from 'react';
import { useNavigate } from 'react-router-dom';
import './vente.css';

function Vente() {
  console.log("🔄 COMPOSANT VENTE RE-RENDER");

  const [ventes, setVentes] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const navigate = useNavigate();

  // Utilisation de useRef pour les données qui ne nécessitent pas de re-render
  const selectedRowsRef = useRef(new Set());
  const checkboxRefs = useRef({});
  const totalRef = useRef(null);

  const formatDate = (dateString) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('fr-FR', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit'
    });
  };

  const fetchVentes = useCallback(() => {
    console.log("📥 FETCH VENTES - Chargement des données");
    setLoading(true);
    fetch('/ventes.json')
      .then((res) => {
        if (!res.ok) throw new Error("Erreur réseau");
        return res.json();
      })
      .then((data) => {
        console.log("✅ DONNÉES CHARGÉES:", data.length, "ventes");
        setVentes(data);
      })
      .catch((err) => {
        console.error("❌ ERREUR FETCH:", err);
        setError("Impossible de charger les ventes.");
      })
      .finally(() => {
        console.log("🏁 FETCH TERMINÉ");
        setLoading(false);
      });
  }, []);

  useEffect(() => {
    fetchVentes();
  }, [fetchVentes]);

  // Fonction pour calculer le total
  const calculateTotal = useCallback(() => {
    console.log("💰 CALCUL TOTAL - Nombre d'éléments sélectionnés:", selectedRowsRef.current.size);
    const total = ventes
      .filter((v) => selectedRowsRef.current.has(v.id_vente))
      .reduce((total, v) => total + parseFloat(v.prix_vente), 0);
    console.log("💰 TOTAL CALCULÉ:", total);
    return total;
  }, [ventes]);

  // Fonction pour mettre à jour le total dans le DOM
  const updateTotal = useCallback(() => {
    console.log("📊 MISE À JOUR TOTAL DOM");
    if (totalRef.current) {
      const total = calculateTotal();
      totalRef.current.textContent = `Total des ventes sélectionnées : ${total.toLocaleString()} Ar`;
      console.log("📊 TOTAL AFFICHÉ:", total.toLocaleString(), "Ar");
    }
  }, [calculateTotal]);

  // Fonction optimisée pour gérer la sélection sans re-render complet
  const toggleRowSelection = useCallback((id) => {
    console.log("🔄 TOGGLE ROW SELECTION - ID:", id);
    const selectedRows = selectedRowsRef.current;
    const checkbox = checkboxRefs.current[id];
    const row = checkbox?.closest('tr');

    if (selectedRows.has(id)) {
      console.log("❌ DÉSELECTION - ID:", id);
      selectedRows.delete(id);
      if (checkbox) {
        checkbox.checked = false;
        console.log("☑️ CHECKBOX DÉCOCHÉE");
      }
      if (row) {
        row.classList.remove('selected');
        console.log("🎨 CLASSE 'selected' SUPPRIMÉE");
      }
    } else {
      console.log("✅ SÉLECTION - ID:", id);
      selectedRows.add(id);
      if (checkbox) {
        checkbox.checked = true;
        console.log("☑️ CHECKBOX COCHÉE");
      }
      if (row) {
        row.classList.add('selected');
        console.log("🎨 CLASSE 'selected' AJOUTÉE");
      }
    }

    // Mise à jour du total sans re-render
    updateTotal();
  }, [updateTotal]);

  // Fonction pour créer les lignes sans useMemo
  const createVentesRows = () => {
    console.log("🏗️ CRÉATION DES LIGNES - Nombre de ventes:", ventes.length);
    return ventes.map((vente) => {
      const isSelected = selectedRowsRef.current.has(vente.id_vente);
      console.log("🔨 CRÉATION LIGNE - ID:", vente.id_vente, "- Sélectionnée:", isSelected);

      return (
        <tr
          key={vente.id_vente}
          className={isSelected ? 'selected' : ''}
        >
          <td>
            <input
              type="checkbox"
              ref={(el) => {
                if (el) {
                  checkboxRefs.current[vente.id_vente] = el;
                  console.log("📎 REF CHECKBOX CRÉÉE - ID:", vente.id_vente);
                }
              }}
              defaultChecked={isSelected}
              onChange={() => toggleRowSelection(vente.id_vente)}
            />
          </td>
          <td>{vente.nom_produit}</td>
          <td>{vente.nom_client}</td>
          <td>{vente.nom_vendeur}</td>
          <td>{vente.quantite}</td>
          <td>{vente.prix_vente}</td>
          <td>{formatDate(vente.date_vente)}</td>
        </tr>
      );
    });
  };

  // Mise à jour du total initial
  useEffect(() => {
    console.log("🚀 EFFET - Mise à jour du total initial");
    updateTotal();
  }, [updateTotal]);

  if (loading) {
    console.log("⏳ ÉTAT LOADING");
    return <p>Chargement des ventes...</p>;
  }
  if (error) {
    console.log("❌ ÉTAT ERROR:", error);
    return <p style={{ color: 'red' }}>{error}</p>;
  }

  console.log("🎨 RENDU PRINCIPAL DU COMPOSANT");
  return (
    <div className="App-vente">
      <div className="vente-container">
        <button className="back-button" onClick={() => navigate(-1)}>
          ⬅ Retour
        </button>
        <h2>Liste des Ventes</h2>
        <table className="styled-table" border="1">
          <thead>
            <tr>
              <th>✔</th>
              <th>Produit</th>
              <th>Client</th>
              <th>Vendeur</th>
              <th>Quantité</th>
              <th>Prix</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            {createVentesRows()}
          </tbody>
        </table>
        <h3 ref={totalRef}>Total des ventes sélectionnées : 0 Ar</h3>
      </div>

      <div className="section-image-vente"> </div>
    </div>
  );
}

export default Vente;
